<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÿµÿ±ŸÅ - Arabic Morphology Analyzer</title>
    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Amiri:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .result-table thead {
            background: linear-gradient(135deg, #10B981 0%, #14B8A6 100%);
            color: white;
        }

        .result-table th {
            padding: 15px 12px;
            text-align: center;
            font-weight: 600;
            font-size: 0.95em;
        }

        .result-table td {
            padding: 14px 12px;
            text-align: center;
            border-bottom: 1px solid #e1e4e8;
            font-size: 0.93em;
        }

        .result-table tbody tr:hover {
            background: #f8f9fa;
        }

        .result-table tbody tr:last-child td {
            border-bottom: none;
        }

        /* Mobile Card Style for Results */
        .mobile-cards {
            display: none;
        }

        .result-card-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f1f2;
        }

        .result-card-row:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .result-card-label {
            font-weight: 600;
            color: #7f8c8d;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            flex-shrink: 0;
            margin-left: 12px;
        }

        .result-card-value {
            color: #2c3e50;
            font-size: 0.95em;
            text-align: left;
            flex-grow: 1;
        }

        @media (max-width: 768px) {
            .result-table {
                display: none;
            }

            .mobile-cards {
                display: block;
            }
        }
    </style>
</head>

<body>
    <!-- Desktop Navigation -->
    <nav class="top-nav">
        <div class="nav-container">
            <div class="nav-logo">
                <span>Quran E'arab</span>
            </div>
            <div class="nav-links">
                <a href="index.html" class="nav-item">E'arab</a>
                <a href="sarf.html" class="nav-item active">Sarf</a>
                <a href="about.html" class="nav-item">About</a>
            </div>
        </div>
    </nav>

    <div class="app-container">
        <div class="card">
            <h1>ÿµÿ±ŸÅ ÿßŸÑŸÇÿ±ÿ¢ŸÜ</h1>
            <div class="subtitle">Arabic Morphology Analyzer</div>

            <div class="info"
                style="background: var(--bg-input); padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 3px solid var(--primary);">
                <p>Enter an Arabic word to analyze its morphology, root, and grammatical forms</p>
            </div>

            <form id="sarfForm">
                <div class="form-group">
                    <label for="wordInput">
                        <span class="arabic-text">ÿ£ÿØÿÆŸÑ ÿßŸÑŸÉŸÑŸÖÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</span>
                        (Enter Arabic Word)
                    </label>
                    <input type="text" id="wordInput" placeholder="ŸÖÿ´ÿßŸÑ: ÿ±ÿØÿØŸÜÿß" required
                        style="text-align: right; direction: rtl;">
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%">
                    Analyze Word
                </button>
            </form>
        </div>

        <div id="loadingSpinner" class="loading-spinner hidden">
            <div class="spinner"></div>
            <p class="text-center mt-4" style="color: var(--primary);">Analyzing word...</p>
        </div>

        <div id="result" class="result hidden fade-in">
            <!-- Results will be injected here -->
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="index.html" class="bottom-nav-item">
            <span class="bottom-nav-icon">üìñ</span>
            <span>E'arab</span>
        </a>
        <a href="sarf.html" class="bottom-nav-item active">
            <span class="bottom-nav-icon">üî§</span>
            <span>Sarf</span>
        </a>
        <a href="about.html" class="bottom-nav-item">
            <span class="bottom-nav-icon">‚ÑπÔ∏è</span>
            <span>About</span>
        </a>
    </nav>

    <script src="script.js"></script>
    <script>
        // Handle form submission
        document.getElementById('sarfForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const wordInput = document.getElementById('wordInput');
            const word = wordInput.value.trim();

            if (!word) {
                alert('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ŸÉŸÑŸÖÿ© ÿπÿ±ÿ®Ÿäÿ©');
                return;
            }

            await analyzeSarf(word);
        });

        // Function to analyze Sarf
        async function analyzeSarf(word) {
            const loadingSpinner = document.getElementById('loadingSpinner');
            const result = document.getElementById('result');

            try {
                // Show loading
                loadingSpinner.classList.remove('hidden');
                result.classList.add('hidden');
                result.innerHTML = ''; // Clear previous results

                // Generate timestamp for cache busting
                const timestamp = new Date().getTime();

                // Build API URL
                const apiUrl = `https://aratools.com/api/v1/dictionary/lookup/ar/${encodeURIComponent(word)}?filter_diacritics=true&_=${timestamp}`;

                // Try multiple CORS proxies
                const proxies = [
                    `https://api.allorigins.win/get?url=${encodeURIComponent(apiUrl)}`,
                    `https://corsproxy.io/?${encodeURIComponent(apiUrl)}`,
                    apiUrl // Try direct access last
                ];

                let data = null;
                let lastError = null;

                // Try each proxy until one works
                for (const proxyUrl of proxies) {
                    try {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 10000);

                        const response = await fetch(proxyUrl, {
                            signal: controller.signal
                        });

                        clearTimeout(timeoutId);

                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }

                        // Check if response is JSON (allorigins format)
                        const contentType = response.headers.get('content-type');
                        if (contentType && contentType.includes('application/json')) {
                            const jsonData = await response.json();
                            if (jsonData.contents) {
                                data = JSON.parse(jsonData.contents);
                            } else {
                                data = jsonData;
                            }
                        } else {
                            const text = await response.text();
                            data = JSON.parse(text);
                        }

                        if (data && data.words) {
                            console.log('Successfully fetched from:', proxyUrl);
                            break;
                        }
                    } catch (error) {
                        lastError = error;
                        console.warn('Proxy failed:', proxyUrl, error.message);
                        continue;
                    }
                }

                if (!data || !data.words) {
                    throw lastError || new Error('Failed to fetch data');
                }

                displayResults(data.words);
                result.classList.remove('hidden');

            } catch (error) {
                console.error('Error:', error);
                result.innerHTML = `
                    <div class="card" style="background: #fee; border-color: #fcc;">
                        <p style="color: #c33; text-align: center;">
                            Failed to analyze word. Please try again later.
                            <br><small>${error.message}</small>
                        </p>
                    </div>
                `;
                result.classList.remove('hidden');
            } finally {
                loadingSpinner.classList.add('hidden');
            }
        }

        function displayResults(words) {
            const resultDiv = document.getElementById('result');

            if (words.length === 0) {
                resultDiv.innerHTML = `
                    <div class="card">
                        <p class="text-center" style="color: var(--text-muted);">No results found for this word.</p>
                    </div>
                `;
                return;
            }

            // Create Table for Desktop
            let tableHtml = `
                <div class="result-table-container">
                    <table class="result-table">
                        <thead>
                            <tr>
                                <th>Form</th>
                                <th>Gloss</th>
                                <th>POS</th>
                                <th>Root</th>
                                <th>Measure</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            // Create Cards for Mobile
            let cardsHtml = '<div class="mobile-cards">';

            words.forEach(word => {
                const arabicWord = word.voc_form || word.form;
                const root = word.root || '-';
                const pos = word.pos_nice || word.pos_abbr || '-';
                const gloss = word.nice_gloss || word.gloss || '-';
                const measure = word.measure || '-';

                // Table Row
                tableHtml += `
                    <tr>
                        <td class="arabic-text" style="font-size: 1.2em; font-weight: bold;">${arabicWord}</td>
                        <td>${gloss}</td>
                        <td>${pos}</td>
                        <td class="arabic-text">${root}</td>
                        <td>${measure}</td>
                    </tr>
                `;

                // Mobile Card
                cardsHtml += `
                    <div class="card result-card">
                        <div class="result-card-row">
                            <span class="result-card-label">Form</span>
                            <span class="result-card-value arabic-text" style="font-size: 1.2em; font-weight: bold;">${arabicWord}</span>
                        </div>
                        <div class="result-card-row">
                            <span class="result-card-label">Gloss</span>
                            <span class="result-card-value">${gloss}</span>
                        </div>
                        <div class="result-card-row">
                            <span class="result-card-label">POS</span>
                            <span class="result-card-value">${pos}</span>
                        </div>
                        <div class="result-card-row">
                            <span class="result-card-label">Root</span>
                            <span class="result-card-value arabic-text">${root}</span>
                        </div>
                        <div class="result-card-row">
                            <span class="result-card-label">Measure</span>
                            <span class="result-card-value">${measure}</span>
                        </div>
                    </div>
                `;
            });

            tableHtml += '</tbody></table></div>';
            cardsHtml += '</div>';

            resultDiv.innerHTML = tableHtml + cardsHtml;
        }
    </script>
</body>

</html>