<!DOCTYPE html>
<html lang="en" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quran E'arab Learning</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #F0FDF4;
            min-height: 100vh;
            padding: 20px 8px;
            margin: 0;
        }

        .container {
            background: white;
            border-radius: 12px;
            padding: 35px 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            max-width: 1000px;
            width: 100%;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 2em;
            font-weight: 700;
            line-height: 1.3;
        }

        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 25px;
            font-size: 0.95em;
            font-weight: 400;
        }

        .form-group {
            margin-bottom: 18px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 0.95em;
        }

        select, input {
            width: 100%;
            padding: 13px 15px;
            border: 1px solid #dcdde1;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s ease;
            background: #fafafa;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #10B981;
            background: white;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.08);
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: left 14px center;
            padding-left: 35px;
        }

        input[type="number"] {
            text-align: center;
        }

        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.05em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        button:hover {
            background: linear-gradient(135deg, #34D399 0%, #10B981 100%);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);
        }

        button:active {
            transform: scale(0.98);
        }

        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            box-shadow: none;
        }

        .result {
            margin-top: 20px;
            padding: 0;
            display: none;
            text-align: right;
        }

        .result.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-link {
            display: inline-block;
            margin-top: 0;
            margin-bottom: 0;
            padding: 10px 24px;
            background: #10B981;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.2s ease;
            font-size: 0.88em;
        }

        .result-link:hover {
            background: #059669;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading-spinner.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #10B981;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .earab-content {
            background: #fafafa;
            padding: 25px;
            border-radius: 8px;
            margin-top: 18px;
            border: 1px solid #e1e4e8;
            line-height: 1.9;
        }

        .earab-content h2 {
            color: #2c3e50;
            font-size: 1.4em;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 700;
        }

        .earab-content .card {
            background: white;
            padding: 22px 20px;
            border-radius: 8px;
            margin-bottom: 16px;
            border-left: 3px solid #10B981;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .earab-content .card-body {
            font-size: 1.08em;
            line-height: 2;
            color: #2c3e50;
        }

        .earab-content p {
            margin-bottom: 12px;
        }

        .source-link {
            text-align: center;
            margin-top: 18px;
            padding-top: 18px;
            border-top: 1px solid #e1e4e8;
        }

        .navigation-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
            padding: 0 20px;
        }

        .nav-btn {
            flex: 1;
            max-width: 200px;
            padding: 12px 20px;
            background: #10B981;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .nav-btn:hover:not(:disabled) {
            background: #059669;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);
        }

        .nav-btn:active:not(:disabled) {
            transform: scale(0.98);
        }

        .nav-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .nav-arrow {
            font-size: 1.2em;
            font-weight: bold;
        }

        .translation-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            margin-top: 20px;
            margin-bottom: 20px;
            border: 1px solid #e1e4e8;
        }

        .translation-item {
            margin-bottom: 18px;
            padding: 16px;
            background: #fafafa;
            border-radius: 6px;
            border-left: 3px solid #14B8A6;
        }

        .translation-label {
            font-weight: 700;
            color: #059669;
            font-size: 0.9em;
            text-transform: uppercase;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .translation-text {
            color: #2c3e50;
            font-size: 1.05em;
            line-height: 1.8;
        }

        .translation-text.urdu {
            font-size: 1.15em;
            text-align: right;
            direction: rtl;
        }

        .surah-info {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e1e4e8;
        }

        .surah-info h3 {
            color: #2c3e50;
            font-size: 1.3em;
            margin-bottom: 5px;
        }

        .surah-info p {
            color: #7f8c8d;
            font-size: 0.95em;
        }

        .error {
            color: #dc3545;
            font-size: 0.9em;
            margin-top: 5px;
            display: none;
        }

        .error.show {
            display: block;
        }

        .loading {
            text-align: center;
            color: #10B981;
            font-style: italic;
        }

        .info {
            background: #f8f9fa;
            padding: 14px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            color: #495057;
            border-left: 3px solid #10B981;
            font-size: 0.93em;
            line-height: 1.6;
        }

        .arabic {
            font-size: 1.2em;
            font-weight: bold;
            color: #059669;
        }

        .navigation {
            text-align: center;
            margin-bottom: 20px;
        }

        .nav-link {
            display: inline-block;
            padding: 8px 16px;
            background: #10B981;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.9em;
            transition: all 0.2s ease;
        }

        .nav-link:hover {
            background: #059669;
            text-decoration: none;
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            body {
                padding: 15px 6px;
            }

            .container {
                padding: 28px 22px;
                border-radius: 10px;
            }

            h1 {
                font-size: 1.75em;
                margin-bottom: 5px;
            }

            .subtitle {
                font-size: 0.88em;
                margin-bottom: 20px;
            }

            .form-group {
                margin-bottom: 16px;
            }

            label {
                font-size: 0.92em;
                margin-bottom: 7px;
            }

            select, input {
                padding: 12px 14px;
                font-size: 16px;
            }

            select {
                padding-left: 32px;
                background-position: left 12px center;
            }

            button {
                padding: 14px;
                font-size: 1.02em;
            }

            .info {
                padding: 12px 14px;
                font-size: 0.9em;
                margin-bottom: 18px;
            }

            .arabic {
                font-size: 1.15em;
            }

            .result {
                margin-top: 18px;
            }

            .result-link {
                padding: 9px 18px;
                font-size: 0.84em;
            }

            .earab-content {
                padding: 18px;
            }

            .earab-content h2 {
                font-size: 1.25em;
                margin-bottom: 16px;
            }

            .earab-content .card {
                padding: 18px 16px;
                font-size: 0.95em;
            }

            .earab-content .card-body {
                font-size: 1.02em;
                line-height: 1.85;
            }

            .translation-section {
                padding: 18px;
                margin-top: 18px;
            }

            .translation-item {
                padding: 14px;
                margin-bottom: 14px;
            }

            .translation-text {
                font-size: 1em;
            }

            .translation-text.urdu {
                font-size: 1.1em;
            }

            .surah-info h3 {
                font-size: 1.15em;
            }

            .surah-info p {
                font-size: 0.88em;
            }

            .navigation-buttons {
                gap: 10px;
                padding: 0 15px;
            }

            .nav-btn {
                font-size: 0.95em;
                padding: 11px 16px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 12px 4px;
            }

            .container {
                padding: 24px 18px;
                border-radius: 8px;
            }

            h1 {
                font-size: 1.6em;
            }

            .subtitle {
                font-size: 0.85em;
                margin-bottom: 18px;
            }

            .form-group {
                margin-bottom: 15px;
            }

            label {
                font-size: 0.9em;
                margin-bottom: 6px;
            }

            select, input {
                padding: 11px 13px;
                font-size: 15px;
            }

            select {
                padding-left: 30px;
                background-position: left 10px center;
            }

            button {
                padding: 13px;
                font-size: 0.98em;
            }

            .info {
                padding: 11px 13px;
                font-size: 0.86em;
                margin-bottom: 16px;
            }

            .arabic {
                font-size: 1.1em;
            }

            .result-link {
                padding: 8px 16px;
                font-size: 0.82em;
            }

            .earab-content {
                padding: 16px 14px;
            }

            .earab-content h2 {
                font-size: 1.15em;
                margin-bottom: 14px;
            }

            .earab-content .card {
                padding: 16px 14px;
                font-size: 0.92em;
            }

            .earab-content .card-body {
                font-size: 0.98em;
                line-height: 1.8;
            }

            .translation-section {
                padding: 16px 14px;
                margin-top: 16px;
            }

            .translation-item {
                padding: 12px;
                margin-bottom: 12px;
            }

            .translation-label {
                font-size: 0.85em;
            }

            .translation-text {
                font-size: 0.95em;
            }

            .translation-text.urdu {
                font-size: 1.05em;
            }

            .surah-info h3 {
                font-size: 1.05em;
            }

            .surah-info p {
                font-size: 0.85em;
            }

            .navigation-buttons {
                gap: 8px;
                padding: 0 10px;
                margin-top: 16px;
            }

            .nav-btn {
                font-size: 0.9em;
                padding: 10px 14px;
                gap: 6px;
            }

            .nav-arrow {
                font-size: 1.1em;
            }
        }

        /* Footer Styles */
        .footer {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px 15px;
            margin-top: 30px;
            text-align: center;
            font-size: 0.82em;
            line-height: 1.5;
        }

        .footer-content {
            max-width: 1000px;
            margin: 0 auto;
        }

        .footer h3 {
            color: #fff;
            font-size: 1em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .footer p {
            margin-bottom: 6px;
            color: #bdc3c7;
        }

        .footer .disclaimer-text {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 6px;
            margin: 12px 0;
            border-left: 3px solid #10B981;
            text-align: center;
        }

        .footer .sources {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer .sources strong {
            color: #fff;
            display: block;
            margin-bottom: 5px;
            font-size: 0.95em;
        }

        .footer a {
            color: #34D399;
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .footer a:hover {
            color: #10B981;
            text-decoration: underline;
        }

        .footer .copyright {
            margin-top: 12px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9em;
            color: #95a5a6;
        }

        .footer .copyright p {
            margin-bottom: 3px;
        }

        @media (max-width: 768px) {
            .footer {
                padding: 18px 15px;
                margin-top: 25px;
                font-size: 0.8em;
            }

            .footer h3 {
                font-size: 0.98em;
                margin-bottom: 8px;
            }

            .footer .disclaimer-text {
                padding: 10px;
                margin: 10px 0;
            }
        }

        @media (max-width: 480px) {
            .footer {
                padding: 15px 12px;
                margin-top: 20px;
                font-size: 0.78em;
            }

            .footer h3 {
                font-size: 0.95em;
            }

            .footer .disclaimer-text {
                padding: 8px;
                margin: 8px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>إعراب القرآن</h1>
        <div class="subtitle">Quran E'arab Learning</div>

        <div class="navigation">
            <a href="sarf.html" class="nav-link">صرف القرآن (Morphology) →</a>
        </div>

        <div class="info">
            <p>Select a Surah and enter an Ayah number to get the grammatical analysis (E'arab)</p>
        </div>

        <form id="earabForm">
            <div class="form-group">
                <label for="surahSelect">
                    <span class="arabic">اختر السورة</span>
                    (Select Surah)
                </label>
                <select id="surahSelect" required>
                    <option value="">Loading Surahs...</option>
                </select>
                <div class="error" id="surahError"></div>
            </div>

            <div class="form-group">
                <label for="ayahInput">
                    <span class="arabic">رقم الآية</span>
                    (Ayah Number)
                </label>
                <input
                    type="number"
                    id="ayahInput"
                    min="1"
                    placeholder="Enter Ayah number"
                    required
                    disabled
                >
                <div class="error" id="ayahError"></div>
            </div>

            <button type="submit" id="submitBtn" disabled>
                عرض الإعراب
            </button>
        </form>

        <div class="loading-spinner" id="loadingSpinner">
            <div class="spinner"></div>
            <p style="margin-top: 15px; color: #10B981;">جاري تحميل الإعراب...</p>
        </div>

        <div class="result" id="result">
            <div class="navigation-buttons">
                <button id="prevAyah" class="nav-btn" onclick="navigateAyah('prev')">
                    <span class="nav-arrow">←</span>
                    <span>Previous Ayah</span>
                </button>
                <button id="nextAyah" class="nav-btn" onclick="navigateAyah('next')">
                    <span>Next Ayah</span>
                    <span class="nav-arrow">→</span>
                </button>
            </div>
            <div id="earabContent" class="earab-content"></div>
            <div id="translationContent" class="translation-section"></div>
            <div class="source-link">
                <a id="earabLink" class="result-link" target="_blank">
                    عرض الصفحة الأصلية
                </a>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <h3>تنويه - Disclaimer</h3>
            <p style="font-weight: 600; color: #fff; margin-bottom: 8px;">هذا التطبيق تعليمي ويستخدم خدمات ومواقع خارجية</p>
            <p style="margin-bottom: 10px;">Educational application using third-party services. Content belongs to original sources.</p>

            <div class="sources">
                <strong>Sources:</strong>
                <p>
                    <a href="https://surahquran.com" target="_blank" rel="noopener">surahquran.com</a> •
                    <a href="https://quranapi.pages.dev" target="_blank" rel="noopener">quranapi.pages.dev</a>
                </p>
            </div>

            <div class="copyright">
                <p>جميع الحقوق محفوظة للمصادر الأصلية - All rights reserved to original sources</p>
            </div>
        </div>
    </footer>

    <script>
        let surahs = [];
        let selectedSurah = null;
        let currentAyah = null;

        // Fetch Surah list from API
        async function fetchSurahs() {
            try {
                const response = await fetch('https://quranapi.pages.dev/api/surah.json');
                if (!response.ok) {
                    throw new Error('Failed to fetch Surahs');
                }
                surahs = await response.json();
                populateSurahDropdown();
            } catch (error) {
                console.error('Error fetching Surahs:', error);
                document.getElementById('surahSelect').innerHTML =
                    '<option value="">Error loading Surahs. Please refresh.</option>';
            }
        }

        // Populate Surah dropdown
        function populateSurahDropdown() {
            const select = document.getElementById('surahSelect');
            select.innerHTML = '<option value="">-- Select a Surah --</option>';

            surahs.forEach((surah, index) => {
                const option = document.createElement('option');
                option.value = index + 1; // Surah number (1-based)
                option.textContent = `${index + 1}. ${surah.surahNameArabic} - ${surah.surahName} (${surah.totalAyah} Ayahs)`;
                option.dataset.totalAyah = surah.totalAyah;
                select.appendChild(option);
            });
        }

        // Handle Surah selection
        document.getElementById('surahSelect').addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            const ayahInput = document.getElementById('ayahInput');
            const submitBtn = document.getElementById('submitBtn');
            const result = document.getElementById('result');

            if (this.value) {
                selectedSurah = {
                    number: parseInt(this.value),
                    totalAyah: parseInt(selectedOption.dataset.totalAyah)
                };

                ayahInput.disabled = false;
                ayahInput.max = selectedSurah.totalAyah;
                ayahInput.value = '';
                submitBtn.disabled = false;
                result.classList.remove('show');

                // Clear errors
                document.getElementById('ayahError').classList.remove('show');
            } else {
                selectedSurah = null;
                ayahInput.disabled = true;
                ayahInput.value = '';
                submitBtn.disabled = true;
            }
        });

        // Validate Ayah number on input
        document.getElementById('ayahInput').addEventListener('input', function() {
            const ayahError = document.getElementById('ayahError');
            const value = parseInt(this.value);

            if (selectedSurah && value > selectedSurah.totalAyah) {
                ayahError.textContent = `رقم الآية لا يمكن أن يتجاوز ${selectedSurah.totalAyah} (إجمالي آيات السورة)`;
                ayahError.classList.add('show');
                this.value = selectedSurah.totalAyah;
            } else if (value < 1) {
                ayahError.textContent = 'رقم الآية يجب أن يكون 1 على الأقل';
                ayahError.classList.add('show');
                this.value = 1;
            } else {
                ayahError.classList.remove('show');
            }
        });

        // Function to fetch and display translation
        async function fetchTranslation(surahNo, ayahNo) {
            const translationContent = document.getElementById('translationContent');

            try {
                const apiUrl = `https://quranapi.pages.dev/api/${surahNo}/${ayahNo}.json`;
                const response = await fetch(apiUrl);

                if (!response.ok) {
                    throw new Error('Failed to fetch translation');
                }

                const data = await response.json();

                // Build translation HTML
                const translationHTML = `
                    <div class="surah-info">
                        <h3>Translations - ${data.surahNameArabic} (${data.surahName})</h3>
                        <p>Ayah ${data.ayahNo} of ${data.totalAyah}</p>
                    </div>

                    <div class="translation-item">
                        <div class="translation-label">English Translation</div>
                        <div class="translation-text">${data.english}</div>
                    </div>

                    <div class="translation-item">
                        <div class="translation-label">اردو ترجمہ (Urdu)</div>
                        <div class="translation-text urdu">${data.urdu}</div>
                    </div>
                `;

                translationContent.innerHTML = translationHTML;

            } catch (error) {
                console.error('Error fetching translation:', error);
                translationContent.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #dc3545;">
                        <p style="font-weight: 600;">عذراً، حدث خطأ أثناء تحميل الترجمة</p>
                        <p style="font-size: 0.9em; margin-top: 8px;">${error.message}</p>
                    </div>
                `;
            }
        }

        // Function to fetch and parse E'arab content
        async function fetchEarabContent(url) {
            const loadingSpinner = document.getElementById('loadingSpinner');
            const result = document.getElementById('result');
            const earabContent = document.getElementById('earabContent');

            try {
                // Show loading
                loadingSpinner.classList.add('show');
                result.classList.remove('show');

                // Try multiple CORS proxies (in order of reliability)
                const proxies = [
                    `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`,
                    `https://corsproxy.io/?${encodeURIComponent(url)}`,
                    `https://thingproxy.freeboard.io/fetch/${url}`,
                    `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`
                ];

                let html = null;
                let lastError = null;

                // Try each proxy until one works
                for (const proxyUrl of proxies) {
                    try {
                        // Add timeout to prevent hanging
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout

                        const response = await fetch(proxyUrl, {
                            signal: controller.signal
                        });

                        clearTimeout(timeoutId);

                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }

                        // Check if response is JSON (allorigins format)
                        const contentType = response.headers.get('content-type');
                        if (contentType && contentType.includes('application/json')) {
                            const data = await response.json();
                            html = data.contents || data.content;
                        } else {
                            html = await response.text();
                        }

                        // If we got valid HTML, break the loop
                        if (html && html.length > 100) {
                            console.log('Successfully fetched from:', proxyUrl);
                            break;
                        }
                    } catch (error) {
                        lastError = error;
                        console.warn('Proxy failed:', proxyUrl, error.message);
                        continue;
                    }
                }

                // If none of the proxies worked, throw error
                if (!html || html.length < 100) {
                    throw lastError || new Error('All proxies failed');
                }

                // Parse HTML
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                // Extract the title with id="e3rab"
                const titleElement = doc.querySelector('a[id="e3rab"] h2');

                // Extract all card elements
                const cardElements = doc.querySelectorAll('.card.mt-3');

                // Build the content
                let content = '';

                // Add title if found
                if (titleElement) {
                    content += `<h2>${titleElement.textContent}</h2>`;
                }

                // Add first two cards
                if (cardElements.length >= 2) {
                    for (let i = 0; i < 2; i++) {
                        const card = cardElements[i];
                        const cardBody = card.querySelector('.card-body');

                        if (cardBody) {
                            content += `<div class="card">${cardBody.innerHTML}</div>`;
                        }
                    }
                } else {
                    // If less than 2 cards, add all available
                    cardElements.forEach(card => {
                        const cardBody = card.querySelector('.card-body');
                        if (cardBody) {
                            content += `<div class="card">${cardBody.innerHTML}</div>`;
                        }
                    });
                }

                // Display content
                earabContent.innerHTML = content;

                // Hide loading, show result
                loadingSpinner.classList.remove('show');
                result.classList.add('show');

                // Scroll to result
                result.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            } catch (error) {
                console.error('Error fetching E\'arab:', error);

                // Hide loading
                loadingSpinner.classList.remove('show');

                // Show error message with fallback link
                earabContent.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #dc3545;">
                        <p style="margin-bottom: 15px; font-weight: 600;">عذراً، حدث خطأ أثناء تحميل الإعراب</p>
                        <p style="margin-bottom: 15px; font-size: 0.95em;">
                            لا يمكن تحميل المحتوى حالياً. الرجاء استخدام الرابط أدناه لعرض الإعراب مباشرة.
                        </p>
                        <p style="font-size: 0.85em; color: #6c757d;">
                            خطأ: ${error.message || 'فشل الاتصال بالخادم'}
                        </p>
                    </div>
                `;

                result.classList.add('show');

                // Scroll to error message
                result.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        // Handle form submission
        document.getElementById('earabForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const ayahInput = document.getElementById('ayahInput');
            const ayahNumber = parseInt(ayahInput.value);
            const ayahError = document.getElementById('ayahError');

            // Validate
            if (!selectedSurah) {
                alert('الرجاء اختيار سورة');
                return;
            }

            if (!ayahNumber || ayahNumber < 1) {
                ayahError.textContent = 'الرجاء إدخال رقم آية صحيح';
                ayahError.classList.add('show');
                return;
            }

            if (ayahNumber > selectedSurah.totalAyah) {
                ayahError.textContent = `رقم الآية لا يمكن أن يتجاوز ${selectedSurah.totalAyah}`;
                ayahError.classList.add('show');
                return;
            }

            // Clear error
            ayahError.classList.remove('show');

            // Generate URL
            const earabUrl = `https://surahquran.com/quran-search/e3rab-aya-${ayahNumber}-sora-${selectedSurah.number}.html`;

            // Set link
            const earabLink = document.getElementById('earabLink');
            earabLink.href = earabUrl;

            // Store current ayah
            currentAyah = ayahNumber;

            // Update ayah input value
            ayahInput.value = ayahNumber;

            // Fetch and display translation and E'arab content
            fetchTranslation(selectedSurah.number, ayahNumber);
            fetchEarabContent(earabUrl);

            // Update navigation buttons
            updateNavigationButtons();
        });

        // Function to navigate to previous/next ayah
        function navigateAyah(direction) {
            if (!selectedSurah || !currentAyah) return;

            let newAyah = currentAyah;

            if (direction === 'prev') {
                newAyah = currentAyah - 1;
            } else if (direction === 'next') {
                newAyah = currentAyah + 1;
            }

            // Validate boundaries
            if (newAyah < 1 || newAyah > selectedSurah.totalAyah) {
                return;
            }

            // Update current ayah
            currentAyah = newAyah;

            // Update input field
            document.getElementById('ayahInput').value = newAyah;

            // Generate URL
            const earabUrl = `https://surahquran.com/quran-search/e3rab-aya-${newAyah}-sora-${selectedSurah.number}.html`;

            // Set link
            const earabLink = document.getElementById('earabLink');
            earabLink.href = earabUrl;

            // Fetch and display content
            fetchTranslation(selectedSurah.number, newAyah);
            fetchEarabContent(earabUrl);

            // Update navigation buttons
            updateNavigationButtons();

            // Scroll to top of results
            document.getElementById('result').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Function to update navigation button states
        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevAyah');
            const nextBtn = document.getElementById('nextAyah');

            if (!selectedSurah || !currentAyah) {
                prevBtn.disabled = true;
                nextBtn.disabled = true;
                return;
            }

            // Disable Previous if at first ayah
            prevBtn.disabled = currentAyah <= 1;

            // Disable Next if at last ayah
            nextBtn.disabled = currentAyah >= selectedSurah.totalAyah;
        }

        // Initialize
        fetchSurahs();
    </script>
</body>
</html>
